---
import type { ExplorerPostView } from "@/lib/blog-explorer";
import type { PostType } from "@/lib/post-types";

interface TypeSectionProps {
  type: PostType;
  posts: ExplorerPostView[];
  label: string;
  description: string;
  typeUrl: string;
  readMoreLabel: string;
  viewAllLabel: string;
  index?: number;
}

const {
  type,
  posts,
  label,
  description,
  typeUrl,
  readMoreLabel,
  viewAllLabel,
  index = 0,
} = Astro.props as TypeSectionProps;

const ensureTrailingSlash = (value: string) => (value.endsWith("/") ? value : `${value}/`);

// Subtle accent variations for each section type
const sectionAccents: Record<PostType, string> = {
  note: "hub-section--sparks",
  article: "hub-section--maps",
  story: "hub-section--mirrors",
  okna: "hub-section--window",
};

const accentClass = sectionAccents[type] || "";
---

<section
  class:list={[
    "hub-section",
    accentClass,
    "relative overflow-hidden rounded-[2rem] border border-soft",
    "p-6 sm:p-8 md:p-10",
  ]}
  style={`--section-index: ${index};`}
>
  {/* Decorative accent line - left edge */}
  <div class="hub-section__accent" aria-hidden="true"></div>

  {/* Subtle background pattern */}
  <div class="hub-section__pattern" aria-hidden="true"></div>

  <div class="relative z-10 flex flex-col gap-8">
    <header class="flex flex-col gap-3">
      <h2 class="font-display text-[clamp(1.8rem,5vw,2.4rem)] font-semibold leading-tight tracking-tight text-strong">
        <a
          href={ensureTrailingSlash(typeUrl)}
          class="hub-section__title-link inline-flex items-center gap-3 transition-colors hover:text-accent"
        >
          <span>{label}</span>
          <span class="hub-section__arrow" aria-hidden="true">â†’</span>
        </a>
      </h2>
      <p class="text-[1.05rem] leading-relaxed text-primary">{description}</p>
    </header>

    {
      posts.length > 0 ? (
        <div class="grid gap-5 sm:gap-6 md:grid-cols-2 xl:grid-cols-3">
          {posts.map((post, postIndex) =>
            type === "note" ? (
              <article
                class="blog-card hub-card flex w-full flex-col gap-3 rounded-3xl border border-soft p-5 sm:p-6"
                key={post.slug}
                style={`--card-index: ${postIndex};`}
              >
                <h3 class="sr-only">{post.title}</h3>
                <p class="whitespace-pre-line text-[clamp(1.1rem,3vw,1.2rem)] leading-relaxed text-strong">
                  {post.snippet || post.title}{" "}
                  <a
                    href={ensureTrailingSlash(post.url)}
                    class="inline-flex items-center text-[1.05em] text-accent/80 transition-colors hover:text-accent focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-accent"
                    aria-label={readMoreLabel}
                  >
                    <span aria-hidden="true">ðŸ¦‹</span>
                  </a>
                </p>
              </article>
            ) : (
              <article
                class="blog-card hub-card flex w-full flex-col gap-5 rounded-[2.5rem] border border-soft p-6 sm:p-8"
                key={post.slug}
                style={`--card-index: ${postIndex};`}
              >
                <div class="flex flex-col gap-3">
                  <h3 class="text-center text-[clamp(1.45rem,4vw,1.85rem)] font-semibold leading-tight text-strong">
                    <a href={ensureTrailingSlash(post.url)} class="text-inherit transition-colors hover:text-accent">
                      {post.title}
                    </a>
                  </h3>
                  {post.snippet ? (
                    <p class="whitespace-pre-line text-[clamp(1.1rem,3vw,1.2rem)] leading-relaxed text-primary">
                      {post.snippet}
                    </p>
                  ) : null}
                </div>
                <div>
                  <a
                    href={ensureTrailingSlash(post.url)}
                    class="button-primary inline-flex items-center gap-2 rounded-full px-4 py-2 text-sm font-semibold transition-transform hover:-translate-y-0.5"
                  >
                    {readMoreLabel}
                    <span aria-hidden="true">â†’</span>
                  </a>
                </div>
              </article>
            ),
          )}
        </div>
      ) : null
    }

    <div class="flex justify-center pt-2">
      <a href={ensureTrailingSlash(typeUrl)} class="action-btn">
        <span class="action-btn__text">{viewAllLabel}</span>
        <span class="action-btn__arrow" aria-hidden="true">
          <svg
            width="14"
            height="14"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2.5"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M5 12h14M12 5l7 7-7 7"></path>
          </svg>
        </span>
        <span class="action-btn__shimmer" aria-hidden="true"></span>
      </a>
    </div>
  </div>
</section>

<style>
  .hub-section {
    --accent-hue: 30;
    --accent-sat: 75%;
    --accent-light: 45%;
    background: var(--surface-card);
    box-shadow:
      var(--shadow-card),
      inset 0 1px 0 0 color-mix(in srgb, white 8%, transparent);
    animation: hub-section-reveal 0.8s cubic-bezier(0.16, 1, 0.3, 1) backwards;
    animation-delay: calc(var(--section-index, 0) * 0.12s);
  }

  @media (prefers-reduced-motion: reduce) {
    .hub-section {
      animation: none;
    }
  }

  @keyframes hub-section-reveal {
    from {
      opacity: 0;
      transform: translateY(32px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Accent line on left edge */
  .hub-section__accent {
    position: absolute;
    left: 0;
    top: 10%;
    bottom: 10%;
    width: 4px;
    border-radius: 0 4px 4px 0;
    background: linear-gradient(
      180deg,
      transparent,
      hsl(var(--accent-hue), var(--accent-sat), var(--accent-light)),
      hsl(calc(var(--accent-hue) + 20), var(--accent-sat), calc(var(--accent-light) + 10%)),
      hsl(var(--accent-hue), var(--accent-sat), var(--accent-light)),
      transparent
    );
    opacity: 0.7;
    transition: opacity 0.3s ease;
  }

  .hub-section:hover .hub-section__accent {
    opacity: 1;
  }

  /* Subtle decorative pattern */
  .hub-section__pattern {
    position: absolute;
    inset: 0;
    opacity: 0.03;
    background-image:
      radial-gradient(circle at 20% 80%, var(--color-accent) 0%, transparent 50%),
      radial-gradient(circle at 80% 20%, var(--color-accent-strong) 0%, transparent 40%);
    pointer-events: none;
  }

  /* Title arrow animation */
  .hub-section__arrow {
    display: inline-block;
    opacity: 0;
    transform: translateX(-8px);
    transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    font-size: 0.8em;
  }

  .hub-section__title-link:hover .hub-section__arrow {
    opacity: 1;
    transform: translateX(0);
  }

  /* Section type accent variations */
  .hub-section--sparks {
    --accent-hue: 45;
    --accent-sat: 85%;
    --accent-light: 55%;
  }

  .hub-section--maps {
    --accent-hue: 160;
    --accent-sat: 50%;
    --accent-light: 40%;
  }

  .hub-section--mirrors {
    --accent-hue: 220;
    --accent-sat: 55%;
    --accent-light: 50%;
  }

  .hub-section--window {
    --accent-hue: 25;
    --accent-sat: 80%;
    --accent-light: 50%;
  }

  /* Card stagger animation and accent line */
  .hub-card {
    position: relative;
    overflow: hidden;
    animation: hub-card-reveal 0.6s cubic-bezier(0.16, 1, 0.3, 1) backwards;
    animation-delay: calc(var(--section-index, 0) * 0.12s + var(--card-index, 0) * 0.08s + 0.2s);
  }

  /* Card left accent line - inherits section color */
  .hub-card::before {
    content: "";
    position: absolute;
    left: 0;
    top: 15%;
    bottom: 15%;
    width: 3px;
    border-radius: 0 3px 3px 0;
    background: linear-gradient(
      180deg,
      transparent,
      hsl(var(--accent-hue), var(--accent-sat), var(--accent-light)),
      hsl(calc(var(--accent-hue) + 15), var(--accent-sat), calc(var(--accent-light) + 8%)),
      hsl(var(--accent-hue), var(--accent-sat), var(--accent-light)),
      transparent
    );
    opacity: 0.5;
    transition: opacity 0.3s ease;
    pointer-events: none;
  }

  .hub-card:hover::before {
    opacity: 0.85;
  }

  @media (prefers-reduced-motion: reduce) {
    .hub-card {
      animation: none;
    }
  }

  @keyframes hub-card-reveal {
    from {
      opacity: 0;
      transform: translateY(20px) scale(0.97);
    }
    to {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
  }
</style>
