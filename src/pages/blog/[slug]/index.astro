---
import { defaultLocale } from "@/i18n/config";
import { findPostLocaleBySlug } from "@/lib/blog";
import { notFound } from "@/lib/http";

const slugParam = Astro.params.slug;
if (!slugParam) {
  return notFound();
}

const matched = findPostLocaleBySlug(slugParam);

if (!matched) {
  return notFound();
}

const targetLocale = matched.locale ?? defaultLocale;
const targetSlug = matched.post.slug;
const target = `/${targetLocale}/blog/${targetSlug}/`;
return Astro.redirect(target, 308);
---
